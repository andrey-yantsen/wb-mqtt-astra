# Описание контролов MQTT
Обработка и заполнение MQTT происходит в соответствии с [соглашением WirenBoard](https://github.com/contactless/homeui/blob/master/conventions.md),
ниже перечислен список доступных контроллов и описание выполняемых ими действий.

## Контролы РИ-М
<dl>
<dt>register</dt>
<dd>Регистрация нового РИ-М / Z. Если устройство с указанным адресом
не найдено — то контрол представлен в виде переключателя, при включении которого
активируется поиск совместимых устройств на шине RS-485 с дальнейшей
регистрацией и назначением адреса первому найденному. После успешной регистрации
(либо если устройство изначально было зарегистрировано) контрол становится
недоступным для записи и в интерфейсе WirenBoard представляет собой
активированный чекбокс. Если после установки в `on` контрол мгновенно
меняет своё состояние обратно (при этом не превращяясь в чекбокс) — значит
приложению не удалось найти на линии ни одного совместимого устройства.</dd>
<dt>register_l2</dt>
<dd>При включении запускает поиск новых извещателей. По окончанию регистрации
(как успешному, так и с ошибкой) автоматически переходит в отключенное состояние.</dd>
<dt>delete_l2_all</dt>
<dd>Удаляет все зарегистрированные извещатели. После активации необходимо
удалить из MQTT все лишние извещатели:

```
mqtt-delete-retained '/devices/astra_1_sensor_1/#'
```
</dd>
<dt>new_radio_mode</dt>
<dd>Для РИ-М — режим работы радиоканала. off — "старый" режим, on — новый.</dd>
<dt>control_time</dt>
<dd>Период контроля канала. Задаётся в десятках секунд (т.е. значение 240
соответствует 40 минутам). Должно быть больше нуля.</dd>
<dt>l2_channel</dt>
<dd>Номер радио-канала, от 1 до 3. Соответсвует литере извещателя.</dd>
<dt>rf_blocked</dt>
<dd>Обнаружена блокировка радиоканала (возникает при наличии хотя бы 2
зарегистрированных извещателей, при отсутствии сообщений по радиоканала в
течение периода контроля).</dd>
</dd>
<dt>rf_failure</dt>
<dd>Общая ошибка радиосети (нет связи с радиомодулем).</dd>
<dt>tamper</dt>
<dd>Обнаружено вскрытие корпуса.</dd>
<dt>power_fault</dt>
<dd>Общее понижение питания.</dd>
<dt>main_power_fault</dt>
<dd>Понижение основного источника питания.</dd>
<dt>reserve_power_fault</dt>
<dd>Понижение резервного источника питания.</dd>
</dl>

## Контролы извещателей
<dl>
<dt>delete_sensor</dt>
<dd>Отменить регистрацию извещателя. После этого действия необходимо произвести
очистку MQTT (не забудьте подставить корректный адрес РИ-М и номер извещателя):

```
mqtt-delete-retained '/devices/astra_1_sensor_1/#'
```
</dd>
<dt>RSSI</dt>
<dd>Значение RSSI при последнем общении с извещателем.</dd>
<dt>IsNoLink</dt>
<dd>С извещателем потеряна связь.</dd>
</dl>

Остальные контролы могут отличаться у разных извещателей, но основные из них —
это `Channel1` и `Channel2`, отвещающие за срабатывание извещателя
соответственно первым и вторым каналом тревоги (например внутренний и внешний
магнитный контакт для Астра-3321).